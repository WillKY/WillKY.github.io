<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Will 的博客</title>
  <icon>https://www.gravatar.com/avatar/305411b99633e3126075909776d7c2ea</icon>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://willky.github.io/"/>
  <updated>2020-07-26T16:19:31.552Z</updated>
  <id>https://willky.github.io/</id>
  
  <author>
    <name>Will</name>
    <email>245666044@qq.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ES查询返回total为10000</title>
    <link href="https://willky.github.io/2020/07/27/ES%E6%9F%A5%E8%AF%A2%E8%BF%94%E5%9B%9Etotal%E4%B8%BA10000/"/>
    <id>https://willky.github.io/2020/07/27/ES查询返回total为10000/</id>
    <published>2020-07-26T16:06:55.000Z</published>
    <updated>2020-07-26T16:19:31.552Z</updated>
    
    <content type="html"><![CDATA[<p>elasticsearch 7.0 默认搜索的时候返回命中总条数为10000, 当我们做业务的时候可能需要用这个数据去做导出或者分页总数据时，这个数据会给我们带来一些困扰。<br>如果需要返回所有命中条数，需要添加一个参数<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"track_total_hits" : true</span><br></pre></td></tr></table></figure></p><p>完整的语法如下:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET you_index/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"track_total_hits"</span>: <span class="literal">true</span>,</span><br><span class="line">     <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"match"</span> : &#123;</span><br><span class="line">            <span class="attr">"message"</span> : <span class="string">"Elasticsearch"</span></span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>如果设置了 track_total_hits 为true， 也意味放放弃一部份性能问题。<br>官方解释如下:</p><p>Track total hits<br>Generally the total hit count can’t be computed accurately without visiting all matches, which is costly for queries that match lots of documents. The track_total_hits parameter allows you to control how the total number of hits should be tracked. Given that it is often enough to have a lower bound of the number of hits, such as “there are at least 10000 hits”, the default is set to 10,000. This means that requests will count the total hit accurately up to 10,000 hits. It’s is a good trade off to speed up searches if you don’t need the accurate number of hits after a certain threshold.</p><p>When set to true the search response will always track the number of hits that match the query accurately (e.g. total.relation will always be equal to “eq” when track_total_hits is set to true). Otherwise the “total.relation” returned in the “total” object in the search response determines how the “total.value” should be interpreted. A value of “gte” means that the “total.value” is a lower bound of the total hits that match the query and a value of “eq” indicates that “total.value” is the accurate count.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;elasticsearch 7.0 默认搜索的时候返回命中总条数为10000, 当我们做业务的时候可能需要用这个数据去做导出或者分页总数据时，这个数据会给我们带来一些困扰。&lt;br&gt;如果需要返回所有命中条数，需要添加一个参数&lt;br&gt;&lt;figure class=&quot;highlig
      
    
    </summary>
    
    
      <category term="elasticsearch" scheme="https://willky.github.io/tags/elasticsearch/"/>
    
      <category term="track_total_hits" scheme="https://willky.github.io/tags/track-total-hits/"/>
    
  </entry>
  
  <entry>
    <title>iOS 13 UICollectionView 布局错乱问题</title>
    <link href="https://willky.github.io/2019/11/01/ios13/"/>
    <id>https://willky.github.io/2019/11/01/ios13/</id>
    <published>2019-11-01T12:09:06.000Z</published>
    <updated>2020-04-16T14:48:58.000Z</updated>
    
    <content type="html"><![CDATA[<p>打开 Layout 的属于编辑界面，修改如图：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://raw.githubusercontent.com/WillKY/WillKY.github.io/master/img/ios13%402x.png" alt="ios13" title="">                </div>                <div class="image-caption">ios13</div>            </figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;打开 Layout 的属于编辑界面，修改如图：&lt;/p&gt;
&lt;figure class=&quot;image-bubble&quot;&gt;
                &lt;div class=&quot;img-lightbox&quot;&gt;
                    &lt;div class=&quot;over
      
    
    </summary>
    
    
      <category term="UICollectionView" scheme="https://willky.github.io/tags/UICollectionView/"/>
    
      <category term="iOS 13" scheme="https://willky.github.io/tags/iOS-13/"/>
    
  </entry>
  
  <entry>
    <title>laravel中使用redis哨兵模式</title>
    <link href="https://willky.github.io/2019/05/08/laravel%E4%B8%AD%E4%BD%BF%E7%94%A8redis%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F/"/>
    <id>https://willky.github.io/2019/05/08/laravel中使用redis哨兵模式/</id>
    <published>2019-05-08T10:37:46.000Z</published>
    <updated>2019-08-10T08:09:28.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>博主使用的laravel 版本是 5.6, 所有以下代码可以使用在laravel 5.6 版本中，其他版本应该也可以使用，未经过测试</p><h1 id="代码配置"><a href="#代码配置" class="headerlink" title="代码配置"></a>代码配置</h1><p>修改database.php 配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$redis = [</span><br><span class="line">     &apos;tcp://192.168.1.207:26379&apos;</span><br><span class="line">      &apos;tcp://192.168.1.225:26381&apos;</span><br><span class="line">     &apos;tcp://192.168.1.209:26380&apos;</span><br><span class="line">        &apos;options&apos; =&gt; [</span><br><span class="line">            &apos;replication&apos; =&gt; &apos;sentinel&apos;,</span><br><span class="line">            &apos;service&apos;     =&gt; env(&apos;REDIS_SENTINEL_SERVICE&apos;, &apos;mymaster&apos;),    //sentinel</span><br><span class="line">            &apos;parameters&apos;  =&gt; [</span><br><span class="line">                &apos;password&apos; =&gt; null,</span><br><span class="line">                &apos;database&apos; =&gt; 0,</span><br><span class="line">            ],</span><br><span class="line">        ],</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">&apos;redis&apos; =&gt; [</span><br><span class="line">        &apos;options&apos; =&gt; [</span><br><span class="line">            &apos;prefix&apos; =&gt; &apos;laravel&apos;,</span><br><span class="line">        ],</span><br><span class="line">        &apos;client&apos; =&gt; &apos;predis&apos;,</span><br><span class="line">        &apos;default&apos; =&gt; $redis,</span><br><span class="line">        &apos;queue&apos;   =&gt; $redis</span><br><span class="line">      ]</span><br><span class="line">    ],</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h1&gt;&lt;p&gt;博主使用的laravel 版本是 5.6, 所有以下代码可以使用在laravel 5.6 版本中，其他版本应该也可以使用，未经过测试&lt;/p&gt;
      
    
    </summary>
    
    
      <category term="laravel" scheme="https://willky.github.io/tags/laravel/"/>
    
      <category term="redis" scheme="https://willky.github.io/tags/redis/"/>
    
      <category term="集群" scheme="https://willky.github.io/tags/%E9%9B%86%E7%BE%A4/"/>
    
  </entry>
  
  <entry>
    <title>laravel中使用swoole加速你的应用</title>
    <link href="https://willky.github.io/2019/03/08/laravel-swoole/"/>
    <id>https://willky.github.io/2019/03/08/laravel-swoole/</id>
    <published>2019-03-08T04:47:46.000Z</published>
    <updated>2019-08-10T08:41:20.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><ul><li>博主使用的laravel 版本是 5.6, 所有以下代码可以使用在laravel 5.6 版本中，其他版本应该也可以使用，未经过测试</li><li>php 7.2</li><li>swoole 4.0 +</li></ul><h1 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h1><p>先使用composer 把我们需要使用的插件库导进来<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require swooletw/laravel-swoole</span><br></pre></td></tr></table></figure></p><h1 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h1><p>打开app.php 配置文件，把<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SwooleTW\Http\LaravelServiceProvider::class,</span><br></pre></td></tr></table></figure></p><p>添加到 providers 中</p><h1 id="生成swoole-配置文件"><a href="#生成swoole-配置文件" class="headerlink" title="生成swoole 配置文件"></a>生成swoole 配置文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan vendor:publish --tag=laravel-swoole</span><br></pre></td></tr></table></figure><p>执行完命令后，我们看到config 文件夹下多了两个文件，如果我们没有使用socket的话，只需要修改swoole-http.php 文件即可. 具体需要修改哪个配置可根据自己的服务器配置去调整</p><h1 id="启动服务，测试"><a href="#启动服务，测试" class="headerlink" title="启动服务，测试"></a>启动服务，测试</h1><p>执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan swoole:http start</span><br></pre></td></tr></table></figure></p><p>此处可以看到控制台把服务器给启动了，把链接复制到浏览器即可使用</p><h1 id="swoole-服务命令"><a href="#swoole-服务命令" class="headerlink" title="swoole 服务命令"></a>swoole 服务命令</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">php artisan swoole:http start //开启http服务</span><br><span class="line">php artisan swoole:http stop  //停止</span><br><span class="line">php artisan swoole:http restart  //重新启动</span><br><span class="line">php artisan swoole:http reload  //热重载，好像并没有什么卵用，测试发现并不是所有的代码都能热重载的</span><br><span class="line">php artisan swoole:http infos  //运行信息</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;博主使用的laravel 版本是 5.6, 所有以下代码可以使用在laravel 5.6 版本中，其他版本应该也可以使用，未经过
      
    
    </summary>
    
    
      <category term="laravel" scheme="https://willky.github.io/tags/laravel/"/>
    
      <category term="redis" scheme="https://willky.github.io/tags/redis/"/>
    
      <category term="集群" scheme="https://willky.github.io/tags/%E9%9B%86%E7%BE%A4/"/>
    
  </entry>
  
  <entry>
    <title>关于我</title>
    <link href="https://willky.github.io/2014/03/01/about/"/>
    <id>https://willky.github.io/2014/03/01/about/</id>
    <published>2014-03-01T10:07:47.000Z</published>
    <updated>2020-04-09T05:04:17.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="技术领域"><a href="#技术领域" class="headerlink" title="技术领域"></a>技术领域</h1><ul><li>PHP</li><li>iOS</li><li>java</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;技术领域&quot;&gt;&lt;a href=&quot;#技术领域&quot; class=&quot;headerlink&quot; title=&quot;技术领域&quot;&gt;&lt;/a&gt;技术领域&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;PHP&lt;/li&gt;
&lt;li&gt;iOS&lt;/li&gt;
&lt;li&gt;java&lt;/li&gt;
&lt;/ul&gt;

      
    
    </summary>
    
    
      <category term="手哥" scheme="https://willky.github.io/tags/%E6%89%8B%E5%93%A5/"/>
    
  </entry>
  
</feed>
