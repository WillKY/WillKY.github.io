<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>ES查询返回total为10000 | Will 的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#ffffff">
    
    
    <meta name="keywords" content="elasticsearch,track_total_hits">
    <meta name="description" content="elasticsearch 7.0 默认搜索的时候返回命中总条数为10000, 当我们做业务的时候可能需要用这个数据去做导出或者分页总数据时，这个数据会给我们带来一些困扰。如果需要返回所有命中条数，需要添加一个参数1&quot;track_total_hits&quot; : true 完整的语法如下:123456789GET you_index/_search&amp;#123;    &quot;track_total_hits&quot;">
<meta name="keywords" content="elasticsearch,track_total_hits">
<meta property="og:type" content="article">
<meta property="og:title" content="ES查询返回total为10000">
<meta property="og:url" content="https://willky.github.io/2020/07/27/ES查询返回total为10000/index.html">
<meta property="og:site_name" content="Will 的博客">
<meta property="og:description" content="elasticsearch 7.0 默认搜索的时候返回命中总条数为10000, 当我们做业务的时候可能需要用这个数据去做导出或者分页总数据时，这个数据会给我们带来一些困扰。如果需要返回所有命中条数，需要添加一个参数1&quot;track_total_hits&quot; : true 完整的语法如下:123456789GET you_index/_search&amp;#123;    &quot;track_total_hits&quot;">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-07-26T16:19:31.552Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ES查询返回total为10000">
<meta name="twitter:description" content="elasticsearch 7.0 默认搜索的时候返回命中总条数为10000, 当我们做业务的时候可能需要用这个数据去做导出或者分页总数据时，这个数据会给我们带来一些困扰。如果需要返回所有命中条数，需要添加一个参数1&quot;track_total_hits&quot; : true 完整的语法如下:123456789GET you_index/_search&amp;#123;    &quot;track_total_hits&quot;">
    
        <link rel="alternate" type="application/atom+xml" title="Will 的博客" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Will</h5>
          <a href="mailto:245666044@qq.com" title="245666044@qq.com" class="mail">245666044@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/">
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives">
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/willky" target="_blank">
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">ES查询返回total为10000</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">ES查询返回total为10000</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-07-26T16:06:55.000Z" itemprop="datePublished" class="page-time">
  2020-07-27
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    

<article id="_post-ES查询返回total为10000" class="post-article article-type-_post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">ES查询返回total为10000</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-07-27 00:06:55" datetime="2020-07-26T16:06:55.000Z" itemprop="datePublished">2020-07-27</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style="display:none">
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>elasticsearch 7.0 默认搜索的时候返回命中总条数为10000, 当我们做业务的时候可能需要用这个数据去做导出或者分页总数据时，这个数据会给我们带来一些困扰。<br>如果需要返回所有命中条数，需要添加一个参数<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"track_total_hits" : true</span><br></pre></td></tr></table></figure></p>
<p>完整的语法如下:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET you_index/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"track_total_hits"</span>: <span class="literal">true</span>,</span><br><span class="line">     <span class="attr">"query"</span>: &#123;</span><br><span class="line">        <span class="attr">"match"</span> : &#123;</span><br><span class="line">            <span class="attr">"message"</span> : <span class="string">"Elasticsearch"</span></span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果设置了 track_total_hits 为true， 也意味放放弃一部份性能问题。<br>官方解释如下:</p>
<p>Track total hits<br>Generally the total hit count can’t be computed accurately without visiting all matches, which is costly for queries that match lots of documents. The track_total_hits parameter allows you to control how the total number of hits should be tracked. Given that it is often enough to have a lower bound of the number of hits, such as “there are at least 10000 hits”, the default is set to 10,000. This means that requests will count the total hit accurately up to 10,000 hits. It’s is a good trade off to speed up searches if you don’t need the accurate number of hits after a certain threshold.</p>
<p>When set to true the search response will always track the number of hits that match the query accurately (e.g. total.relation will always be equal to “eq” when track_total_hits is set to true). Otherwise the “total.relation” returned in the “total” object in the search response determines how the “total.value” should be interpreted. A value of “gte” means that the “total.value” is a lower bound of the total hits that match the query and a value of “eq” indicates that “total.value” is the accurate count.</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        

        
        转载请注明来源 <a href="/2020/07/27/ES查询返回total为10000/" target="_blank" rel="external">https://willky.github.io/2020/07/27/ES查询返回total为10000/</a>
        
    </div>
    
    <footer>
        <a href="https://willky.github.io">
            <img src="/img/avatar.png" alt="Will">
            Will
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elasticsearch/">elasticsearch</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/track-total-hits/">track_total_hits</a></li></ul>


            


        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/08/05/ES查看分数及进行修改/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">ES查看分数及进行修改</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2019/11/01/ios13/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">iOS 13 UICollectionView 布局错乱问题</h4>
      </a>
    </div>
  
</nav>



    








<section class="comments" id="comments">
    <div id="gitment_thread"></div>
    <link rel="stylesheet" href="//unpkg.com/gitment/style/default.css">
    <script src="//unpkg.com/gitment/dist/gitment.browser.js"></script>
    <script>
        var gitment = new Gitment({
            owner: '',
            repo: '',
            oauth: {
                client_id: '',
                client_secret: '',
            },
        })
        gitment.render('comments')
    </script>
</section>













</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢你的赞赏
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check" data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style="display:none">
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style="display:none">
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Will &copy; 2013 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>


    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: false, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'Will的技术博客';
            clearTimeout(titleTime);
        } else {
            document.title = 'Will的技术博客';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
